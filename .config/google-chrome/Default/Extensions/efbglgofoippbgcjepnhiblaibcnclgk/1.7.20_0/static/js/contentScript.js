(()=>{!function(){try{const e=document.head||document.documentElement,t=document.createElement("script");t.src=chrome.runtime.getURL("inpage.js"),e.insertBefore(t,e.children[0]),e.removeChild(t)}catch(e){console.error("Martian wallet injection failed.",e)}}();chrome.runtime.onMessage.addListener(((e,t,n)=>{"changeAddress"===e.subject&&window.dispatchEvent(new CustomEvent("changeAddress",{detail:{address:e.data.address}}))})),chrome.runtime.onMessage.addListener(((e,t,n)=>{"martian_wallet_network_change"===e.subject&&window.dispatchEvent(new CustomEvent("martian_wallet_network_change",{detail:{networkName:e.data.networkName}}))})),window.addEventListener("martian_injected_script_message",(function(e){if(e.detail.method){const t=(e=>{let t=e.querySelector("link[rel='apple-touch-icon']");t?t=t.href:e.querySelector("link[rel='icon']")&&(t=e.querySelector("link[rel='icon']").href);let n=e.querySelector("meta[property='og:title']");return n=n?n.getAttribute("content"):e.title,{iconUrl:t,docTitle:n}})(document),n={iconUrl:t.iconUrl,docTitle:t.docTitle};e.detail.metainfo=n;const a={...e.detail,metainfo:n};chrome.runtime.sendMessage({channel:"martian_contentscript_background_channel",details:{...a}},(function(t){var n;t&&("connect"===e.detail.method&&200===(null===(n=e.detail)||void 0===n?void 0:n.status)&&(chrome.storage.local.get("connectedTabIds",(e=>{const n=e.connectedTabIds;if(n){if(!Object.values(JSON.parse(n).value).includes(t.tabId.toString())||!Object.values(JSON.parse(n).value).includes(t.tabId)){const e=Object.values(JSON.parse(n).value);e.push(t.tabId);const a=JSON.stringify({value:e});chrome.storage.local.set({connectedTabIds:a})}}else{const e=[];e.push(t.tabId);const n=JSON.stringify({value:e});chrome.storage.local.set({connectedTabIds:n})}})),delete t.tabId,delete t.method,delete t.id),window.dispatchEvent(new CustomEvent("martian_contentscript_message",{detail:{responseMethod:e.detail.method,id:e.detail.id,response:t}})))}))}}))})();